; generated by ARM C/C++ Compiler, 4.1 [Build 894]
; commandline ArmCC [--debug -c --asm -o..\Output\uart.o --depend=..\Output\uart.d --cpu=Cortex-M3 --apcs=interwork -O0 -I.\src -I.\inc -I..\CMSIS -I"E:\Keil 4 ARM\ARM\RV31\Inc" -I"E:\Keil 4 ARM\ARM\CMSIS\Include" -I"E:\Keil 4 ARM\ARM\Inc\ST\STM32F10x" -DSTM32F10X_CL --omf_browse=..\Output\uart.crf src\UART.c]
        THUMB
        REQUIRE8
        PRESERVE8

        AREA ||.text||, CODE, READONLY, ALIGN=2

USART1_Send PROC
        LDR      r0,|L1.812|
        LDRB     r0,[r0,#0]  ; U1_TXfin
        AND      r0,r0,#0xf
        CMP      r0,#0xd
        BNE      |L1.54|
        LDR      r0,|L1.812|
        LDRB     r0,[r0,#0]  ; U1_TXfin
        AND      r0,r0,#0xf5
        LDR      r1,|L1.812|
        STRB     r0,[r1,#0]
        MOVS     r0,#0x32
        LDR      r1,|L1.816|
        STRH     r0,[r1,#0]
        MOVS     r0,#1
        LDR      r1,|L1.820|
        STRB     r0,[r1,#0]
        LSLS     r0,r0,#8
        LDR      r1,|L1.824|
        STR      r0,[r1,#0]
        LDR      r0,|L1.828|
        LDRH     r0,[r0,#0]
        ORR      r0,r0,#0x80
        LDR      r1,|L1.828|
        STRH     r0,[r1,#0]
|L1.54|
        BX       lr
        ENDP

USART1_IRQHandler PROC
        LDR      r1,|L1.828|
        LDRH     r1,[r1,#0]
        AND      r1,r1,#0x88
        CMP      r1,#0x88
        BNE      |L1.138|
        LDR      r1,|L1.828|
        SUBS     r1,r1,#0xc
        LDRH     r1,[r1,#0]
        TST      r1,#0x80
        BEQ      |L1.138|
        LDR      r1,|L1.832|
        LDRH     r2,[r1,#0]  ; U1_TXlen
        LDRH     r1,[r1,#0]  ; U1_TXlen
        ADDS     r1,r1,#1
        LDR      r3,|L1.832|
        STRH     r1,[r3,#0]
        LDR      r1,|L1.836|
        LDRB     r1,[r1,r2]
        LDR      r2,|L1.828|
        SUBS     r2,r2,#8
        STRH     r1,[r2,#0]
        LDR      r1,|L1.840|
        LDRH     r1,[r1,#0]  ; U1_RxTxLen
        MOV      r2,r3
        LDRH     r2,[r2,#0]  ; U1_TXlen
        CMP      r1,r2
        BNE      |L1.136|
        LDR      r1,|L1.828|
        LDRH     r1,[r1,#0]
        BIC      r1,r1,#0x80
        LDR      r2,|L1.828|
        STRH     r1,[r2,#0]
        MOV      r1,r2
        LDRH     r1,[r1,#0]
        ORR      r1,r1,#0x40
        STRH     r1,[r2,#0]
|L1.136|
        BX       lr
|L1.138|
        LDR      r1,|L1.828|
        LDRH     r1,[r1,#0]
        AND      r1,r1,#0x48
        CMP      r1,#0x48
        BNE      |L1.266|
        LDR      r1,|L1.828|
        SUBS     r1,r1,#0xc
        LDRH     r1,[r1,#0]
        TST      r1,#0x40
        BEQ      |L1.266|
        LDR      r1,|L1.828|
        LDRH     r1,[r1,#0]
        BIC      r1,r1,#0x40
        LDR      r2,|L1.828|
        STRH     r1,[r2,#0]
        LDR      r1,|L1.828|
        SUBS     r1,r1,#0xc
        LDRH     r1,[r1,#0]
        BIC      r1,r1,#0x40
        LDR      r2,|L1.828|
        SUBS     r2,r2,#0xc
        STRH     r1,[r2,#0]
        LDR      r1,|L1.844|
        LDR      r1,[r1,#0xc]
        EOR      r1,r1,#0x4000
        LDR      r2,|L1.844|
        STR      r1,[r2,#0xc]
        MOVS     r1,#0
        LDR      r2,|L1.832|
        STRH     r1,[r2,#0]
        LDR      r2,|L1.820|
        STRB     r1,[r2,#0]
        MOV      r1,#0xffff
        LDR      r2,|L1.816|
        STRH     r1,[r2,#0]
        LDR      r1,|L1.812|
        LDRB     r1,[r1,#0]  ; U1_TXfin
        AND      r1,r1,#0xfa
        LDR      r2,|L1.812|
        STRB     r1,[r2,#0]
        MOVS     r1,#2
        LDR      r2,|L1.848|
        STRB     r1,[r2,#0]
        MOVS     r1,#0
        LDR      r2,|L1.840|
        STRH     r1,[r2,#0]
        MOV      r1,#0x1000000
        LDR      r2,|L1.824|
        STR      r1,[r2,#0]
        LDR      r1,|L1.828|
        LDRH     r1,[r1,#0]
        ORR      r1,r1,#4
        LDR      r2,|L1.828|
        STRH     r1,[r2,#0]
        B        |L1.136|
|L1.266|
        LDR      r1,|L1.828|
        LDRH     r1,[r1,#0]
        AND      r1,r1,#0x24
        CMP      r1,#0x24
        BNE      |L1.532|
        LDR      r1,|L1.828|
        SUBS     r1,r1,#0xc
        LDRH     r1,[r1,#0]
        TST      r1,#0x20
        BEQ      |L1.532|
        MOVS     r1,#0
        LDR      r2,|L1.852|
        STRB     r1,[r2,#0]
        LDR      r1,|L1.848|
        LDRB     r1,[r1,#0]  ; U1_RXfin
        ANDS     r1,r1,#3
        BEQ      |L1.316|
        CMP      r1,#1
        BEQ      |L1.362|
        CMP      r1,#2
        BNE      |L1.376|
        B        |L1.328|
|L1.316|
        MOVS     r1,#2
        LDR      r2,|L1.856|
        STRH     r1,[r2,#0]
        LDR      r2,|L1.852|
        STRB     r1,[r2,#0]
        B        |L1.378|
|L1.328|
        MOVS     r1,#0
        LDR      r2,|L1.860|
        STRB     r1,[r2,#0]
        LDR      r2,|L1.864|
        STRB     r1,[r2,#0]
        LDR      r2,|L1.868|
        STRB     r1,[r2,#0]
        LDR      r2,|L1.840|
        STRH     r1,[r2,#0]
        LDR      r2,|L1.848|
        STRB     r1,[r2,#0]
        MOVS     r1,#2
        LDR      r2,|L1.856|
        STRH     r1,[r2,#0]
        LDR      r2,|L1.852|
        STRB     r1,[r2,#0]
        B        |L1.378|
|L1.362|
        MOVS     r1,#2
        LDR      r2,|L1.848|
        STRB     r1,[r2,#0]
        MOVS     r1,#0
        LDR      r2,|L1.852|
        STRB     r1,[r2,#0]
        B        |L1.136|
|L1.376|
        NOP      
|L1.378|
        NOP      
        LDR      r1,|L1.828|
        SUBS     r1,r1,#0xc
        LDRH     r1,[r1,#0]
        TST      r1,#0xf
        BEQ      |L1.466|
        LDR      r1,|L1.828|
        SUBS     r1,r1,#8
        LDRH     r1,[r1,#0]
        UXTB     r0,r1
        LDR      r1,|L1.828|
        SUBS     r1,r1,#0xc
        LDRH     r1,[r1,#0]
        UXTB     r0,r1
        MOVS     r1,#0
        LDR      r2,|L1.840|
        STRH     r1,[r2,#0]
        LDR      r2,|L1.868|
        STRB     r1,[r2,#0]
        LDR      r1,|L1.864|
        LDRB     r1,[r1,#0]  ; Errcount
        ADDS     r1,r1,#1
        UXTB     r1,r1
        LDR      r2,|L1.864|
        STRB     r1,[r2,#0]
        CMP      r1,#5
        BLT      |L1.464|
        MOVS     r1,#0
        LDR      r2,|L1.848|
        STRB     r1,[r2,#0]
        LDR      r1,|L1.828|
        LDRH     r1,[r1,#0]
        BIC      r1,r1,#4
        LDR      r2,|L1.828|
        STRH     r1,[r2,#0]
        MOVS     r1,#0xa
        LDR      r2,|L1.856|
        STRH     r1,[r2,#0]
        MOVS     r1,#3
        LDR      r2,|L1.852|
        STRB     r1,[r2,#0]
|L1.464|
        B        |L1.136|
|L1.466|
        LDR      r1,|L1.864|
        LDRB     r2,[r1,#0]  ; Errcount
        LDRB     r1,[r1,#0]  ; Errcount
        SUBS     r1,r1,#1
        LDR      r3,|L1.864|
        STRB     r1,[r3,#0]
        CBNZ     r2,|L1.486|
        MOVS     r1,#0
        MOV      r2,r3
        STRB     r1,[r2,#0]
|L1.486|
        LDR      r1,|L1.828|
        SUBS     r1,r1,#8
        LDRH     r1,[r1,#0]
        UXTB     r0,r1
        LDR      r1,|L1.860|
        LDRB     r1,[r1,#0]  ; U1_RXflag
        TST      r1,#2
        BNE      |L1.612|
        LDR      r1,|L1.840|
        LDRH     r1,[r1,#0]  ; U1_RxTxLen
        CBNZ     r1,|L1.562|
        LDR      r1,|L1.868|
        LDRB     r2,[r1,#0]  ; Headcapfail
        LDRB     r1,[r1,#0]  ; Headcapfail
        ADDS     r1,r1,#1
        LDR      r3,|L1.868|
        STRB     r1,[r3,#0]
        CMP      r2,#0xa
        BNE      |L1.562|
        MOVS     r1,#0
        LDR      r2,|L1.848|
        B        |L1.534|
|L1.532|
        B        |L1.602|
|L1.534|
        STRB     r1,[r2,#0]
        LDR      r1,|L1.828|
        LDRH     r1,[r1,#0]
        BIC      r1,r1,#4
        LDR      r2,|L1.828|
        STRH     r1,[r2,#0]
        MOVS     r1,#0xa
        LDR      r2,|L1.856|
        STRH     r1,[r2,#0]
        MOVS     r1,#3
        LDR      r2,|L1.852|
        STRB     r1,[r2,#0]
        B        |L1.136|
|L1.562|
        LDR      r1,|L1.840|
        LDRH     r2,[r1,#0]  ; U1_RxTxLen
        LDRH     r1,[r1,#0]  ; U1_RxTxLen
        ADDS     r1,r1,#1
        LDR      r3,|L1.840|
        STRH     r1,[r3,#0]
        LDR      r1,|L1.836|
        LDRB     r1,[r1,r2]
        CMP      r1,r0
        BNE      |L1.604|
        MOV      r1,r3
        LDRH     r1,[r1,#0]  ; U1_RxTxLen
        CMP      r1,#5
        BNE      |L1.668|
        LDR      r1,|L1.860|
        LDRB     r1,[r1,#0]  ; U1_RXflag
        ORR      r1,r1,#2
        LDR      r2,|L1.860|
        STRB     r1,[r2,#0]
|L1.602|
        B        |L1.668|
|L1.604|
        MOVS     r1,#0
        LDR      r2,|L1.840|
        STRH     r1,[r2,#0]
        B        |L1.668|
|L1.612|
        LDR      r1,|L1.848|
        LDRB     r1,[r1,#0]  ; U1_RXfin
        TST      r1,#0x80
        BEQ      |L1.624|
        B        |L1.136|
|L1.624|
        LDR      r1,|L1.840|
        LDRH     r1,[r1,#0]  ; U1_RxTxLen
        CMP      r1,#0x33
        BGE      |L1.650|
        LDR      r1,|L1.840|
        LDRH     r2,[r1,#0]  ; U1_RxTxLen
        LDRH     r1,[r1,#0]  ; U1_RxTxLen
        ADDS     r1,r1,#1
        LDR      r3,|L1.840|
        STRH     r1,[r3,#0]
        LDR      r1,|L1.836|
        STRB     r0,[r1,r2]
        B        |L1.668|
|L1.650|
        MOVS     r1,#0
        LDR      r2,|L1.840|
        STRH     r1,[r2,#0]
        LDR      r1,|L1.848|
        LDRB     r1,[r1,#0]  ; U1_RXfin
        ORR      r1,r1,#0x80
        LDR      r2,|L1.848|
        STRB     r1,[r2,#0]
|L1.668|
        NOP      
        B        |L1.136|
        ENDP

UART_Init PROC
        LDR      r0,|L1.872|
        LDR      r0,[r0,#0x18]
        MOV      r1,#0x4005
        ORRS     r0,r0,r1
        LDR      r1,|L1.872|
        STR      r0,[r1,#0x18]
        MOV      r0,#0x1000000
        LDR      r1,|L1.824|
        STR      r0,[r1,#0]
        ASRS     r0,r0,#15
        STR      r0,[r1,#0]
        LSLS     r0,r0,#1
        STR      r0,[r1,#0]
        LDR      r0,|L1.824|
        SUBS     r0,r0,#0xc
        LDR      r0,[r0,#0]
        MOV      r1,#0x333
        BICS     r0,r0,r1
        LDR      r1,|L1.824|
        SUBS     r1,r1,#0xc
        STR      r0,[r1,#0]
        MOV      r0,r1
        LDR      r0,[r0,#0]
        ORR      r0,r0,#0x32
        STR      r0,[r1,#0]
        MOV      r0,r1
        LDR      r0,[r0,#0]
        MOV      r1,#0xccc
        BICS     r0,r0,r1
        LDR      r1,|L1.824|
        SUBS     r1,r1,#0xc
        STR      r0,[r1,#0]
        MOV      r0,r1
        LDR      r0,[r0,#0]
        ORR      r0,r0,#0x880
        STR      r0,[r1,#0]
        LDR      r0,|L1.876|
        LDR      r0,[r0,#4]
        BIC      r0,r0,#4
        LDR      r1,|L1.876|
        STR      r0,[r1,#4]
        MOV      r0,#0x1d4c
        LDR      r1,|L1.828|
        SUBS     r1,r1,#4
        STRH     r0,[r1,#0]
        MOVS     r0,#0
        LDR      r1,|L1.828|
        ADDS     r1,r1,#0xc
        STRH     r0,[r1,#0]
        SUBS     r1,r1,#4
        STRH     r0,[r1,#0]
        SUBS     r1,r1,#4
        STRH     r0,[r1,#0]
        MOV      r0,#0x202c
        SUBS     r1,r1,#4
        STRH     r0,[r1,#0]
        MOV      r0,#0x1000000
        LDR      r1,|L1.824|
        STR      r0,[r1,#0]
        BX       lr
        ENDP

|L1.812|
        DCD      U1_TXfin
|L1.816|
        DCD      U1_TXresettime
|L1.820|
        DCD      TXtimememb
|L1.824|
        DCD      0x40010810
|L1.828|
        DCD      0x4001380c
|L1.832|
        DCD      U1_TXlen
|L1.836|
        DCD      U1_FIFOBuff
|L1.840|
        DCD      U1_RxTxLen
|L1.844|
        DCD      0x40011000
|L1.848|
        DCD      U1_RXfin
|L1.852|
        DCD      RXtimememb
|L1.856|
        DCD      U1_RXresettime
|L1.860|
        DCD      U1_RXflag
|L1.864|
        DCD      Errcount
|L1.868|
        DCD      Headcapfail
|L1.872|
        DCD      0x40021000
|L1.876|
        DCD      0x40010000

        AREA ||.arm_vfe_header||, DATA, READONLY, NOALLOC, ALIGN=2

        DCD      0x00000000

        AREA ||.data||, DATA, ALIGN=1

U1_FIFOBuff
        DCB      0xf0,0xe1,0xd2,0xc3
        DCB      0x05,0x00,0x00,0x00
        %        40
        DCB      0x00,0x00,0x00,0x00
U1_RxTxLen
        DCW      0x0000
U1_RXfin
        DCB      0x02
U1_TXfin
        DCB      0x00
U1_RXflag
        DCB      0x00
Errcount
        DCB      0x00
Headcapfail
        DCB      0x00,0x00
U1_TXlen
        DCB      0x00,0x00

        EXPORT USART1_Send [CODE]
        EXPORT USART1_IRQHandler [CODE]
        EXPORT UART_Init [CODE]
        EXPORT U1_FIFOBuff [DATA,SIZE=51]
        EXPORT U1_RxTxLen [DATA,SIZE=2]
        EXPORT U1_RXfin [DATA,SIZE=1]
        EXPORT U1_TXfin [DATA,SIZE=1]

        IMPORT ||Lib$$Request$$armlib|| [CODE,WEAK]
        IMPORT U1_TXresettime [DATA]
        IMPORT TXtimememb [DATA]
        IMPORT RXtimememb [DATA]
        IMPORT U1_RXresettime [DATA]

        KEEP U1_RXflag
        KEEP Errcount
        KEEP Headcapfail
        KEEP U1_TXlen

        ATTR FILESCOPE
        ATTR SETVALUE Tag_ABI_PCS_wchar_t,2
        ATTR SETVALUE Tag_ABI_enum_size,1
        ATTR SETVALUE Tag_ABI_optimization_goals,6
        ATTR SETSTRING Tag_conformance,"2.06"
        ATTR SETVALUE AV,18,1

        ASSERT {ENDIAN} = "little"
        ASSERT {INTER} = {TRUE}
        ASSERT {ROPI} = {FALSE}
        ASSERT {RWPI} = {FALSE}
        ASSERT {IEEE_FULL} = {FALSE}
        ASSERT {IEEE_PART} = {FALSE}
        ASSERT {IEEE_JAVA} = {FALSE}
        END
